{"id":5567,"date":"2022-11-15T06:11:18","date_gmt":"2022-11-15T06:11:18","guid":{"rendered":"https:\/\/www.pythontutorial.net\/?page_id=5567"},"modified":"2023-01-20T06:53:45","modified_gmt":"2023-01-20T06:53:45","slug":"django-migrations","status":"publish","type":"page","link":"https:\/\/www.pythontutorial.net\/django-tutorial\/django-migrations\/","title":{"rendered":"Django Migrations"},"content":{"rendered":"\n<p><strong>Summary<\/strong>: in this tutorial, you&#8217;ll learn how to create models and use Django migrations to create database tables.<\/p>\n\n\n\n<p class=\"note\">This tutorial begins where&nbsp;the <a href=\"https:\/\/www.pythontutorial.net\/django-tutorial\/django-models\/\">Django models tutorial<\/a> left off.<\/p>\n\n\n\n<h2>Introduction to Django migration commands<\/h2>\n\n\n\n<p>When working with Django, you don&#8217;t need to write SQL to create new tables or make changes to existing tables. Instead, you use Django migrations. <\/p>\n\n\n\n<p>Django migrations allow you to propagate the changes that you make to the <a href=\"https:\/\/www.pythontutorial.net\/django-tutorial\/django-models\/\">models<\/a> to the database via the command line.<\/p>\n\n\n\n<p>Django provides you with some commands for creating new migrations based on the changes that you made to the model and applying the migrations to the database.<\/p>\n\n\n\n<p>The process for making changes to models, creating migrations, and applying the changes to the database is as follows:<\/p>\n\n\n\n<ul>\n<li>First, define new models or make changes to existing models.<\/li>\n\n\n\n<li>Second, make new migrations by running the <code>makemigrations<\/code> command.<\/li>\n\n\n\n<li>Third, apply the changes from the models to the database by executing the <code>migrate<\/code> command.<\/li>\n<\/ul>\n\n\n\n<p>Suppose that you define the <code>Post<\/code> models in the <code>blog<\/code> application like this:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-1\" data-shcb-language-name=\"Python\" data-shcb-language-slug=\"python\"><span><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from<\/span> django.db <span class=\"hljs-keyword\">import<\/span> models\n<span class=\"hljs-keyword\">from<\/span> django.utils <span class=\"hljs-keyword\">import<\/span> timezone\n<span class=\"hljs-keyword\">from<\/span> django.contrib.auth.models <span class=\"hljs-keyword\">import<\/span> User\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class<\/span> <span class=\"hljs-title\">Post<\/span><span class=\"hljs-params\">(models.Model)<\/span>:<\/span>\n    title = models.CharField(max_length=<span class=\"hljs-number\">120<\/span>)\n    content = models.TextField()\n    published_at = models.DateTimeField(default=timezone.now)\n    author = models.ForeignKey(User, on_delete=models.CASCADE)\n    \n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">__str__<\/span><span class=\"hljs-params\">(self)<\/span>:<\/span>\n        <span class=\"hljs-keyword\">return<\/span> self.title<\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-1\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">Python<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">python<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>and you can create a new migration using the <code>makemigrations<\/code> command:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-2\" data-shcb-language-name=\"CSS\" data-shcb-language-slug=\"css\"><span><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">python<\/span> <span class=\"hljs-selector-tag\">manage<\/span><span class=\"hljs-selector-class\">.py<\/span> <span class=\"hljs-selector-tag\">makemigrations<\/span><\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-2\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">CSS<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">css<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>The <code>makemigrations<\/code> command scans the <code>models.py<\/code> file, detects changes, and makes corresponding migrations. It&#8217;ll show the following output:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-3\" data-shcb-language-name=\"plaintext\" data-shcb-language-slug=\"plaintext\"><span><code class=\"hljs language-plaintext\">Migrations for 'blog':\n  blog\\migrations\\0001_initial.py\n    - Create model Post<\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-3\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">plaintext<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">plaintext<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>Behind the scene, the command creates the file <code>migrations\\0001_initial.py<\/code> file. <\/p>\n\n\n\n<p>To preview the SQL that Django will run to create the <code>blog_post<\/code> table in the database, you use the <code>sqlmigrate<\/code> command:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-4\" data-shcb-language-name=\"CSS\" data-shcb-language-slug=\"css\"><span><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">python<\/span> <span class=\"hljs-selector-tag\">manage<\/span><span class=\"hljs-selector-class\">.py<\/span> <span class=\"hljs-selector-tag\">sqlmigrate<\/span> <span class=\"hljs-selector-tag\">blog<\/span> 0001<\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-4\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">CSS<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">css<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>In this <code>sqlmigrate<\/code> command, the <code>blog<\/code> is the name of the application and <code>0001<\/code> is the migration number.<\/p>\n\n\n\n<p>It&#8217;ll output the following:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-5\" data-shcb-language-name=\"SQL (Structured Query Language)\" data-shcb-language-slug=\"sql\"><span><code class=\"hljs language-sql\"><span class=\"hljs-keyword\">BEGIN<\/span>;\n<span class=\"hljs-comment\">--<\/span>\n<span class=\"hljs-comment\">-- Create model Post<\/span>\n<span class=\"hljs-comment\">--<\/span>\n<span class=\"hljs-keyword\">CREATE<\/span> <span class=\"hljs-keyword\">TABLE<\/span> <span class=\"hljs-string\">\"blog_post\"<\/span> (\n  <span class=\"hljs-string\">\"id\"<\/span> <span class=\"hljs-built_in\">integer<\/span> <span class=\"hljs-keyword\">NOT<\/span> <span class=\"hljs-literal\">NULL<\/span> PRIMARY <span class=\"hljs-keyword\">KEY<\/span> AUTOINCREMENT, \n  <span class=\"hljs-string\">\"title\"<\/span> <span class=\"hljs-built_in\">varchar<\/span>(<span class=\"hljs-number\">120<\/span>) <span class=\"hljs-keyword\">NOT<\/span> <span class=\"hljs-literal\">NULL<\/span>, \n  <span class=\"hljs-string\">\"content\"<\/span> <span class=\"hljs-built_in\">text<\/span> <span class=\"hljs-keyword\">NOT<\/span> <span class=\"hljs-literal\">NULL<\/span>, \n  <span class=\"hljs-string\">\"published_at\"<\/span> datetime <span class=\"hljs-keyword\">NOT<\/span> <span class=\"hljs-literal\">NULL<\/span>, \n  <span class=\"hljs-string\">\"author_id\"<\/span> <span class=\"hljs-built_in\">integer<\/span> <span class=\"hljs-keyword\">NOT<\/span> <span class=\"hljs-literal\">NULL<\/span> <span class=\"hljs-keyword\">REFERENCES<\/span> <span class=\"hljs-string\">\"auth_user\"<\/span> (<span class=\"hljs-string\">\"id\"<\/span>) \n   DEFERRABLE <span class=\"hljs-keyword\">INITIALLY<\/span> <span class=\"hljs-keyword\">DEFERRED<\/span>\n);\n\n<span class=\"hljs-keyword\">CREATE<\/span> <span class=\"hljs-keyword\">INDEX<\/span> <span class=\"hljs-string\">\"blog_post_author_id_dd7a8485\"<\/span> \n<span class=\"hljs-keyword\">ON<\/span> <span class=\"hljs-string\">\"blog_post\"<\/span> (<span class=\"hljs-string\">\"author_id\"<\/span>);\n\n<span class=\"hljs-keyword\">COMMIT<\/span>;<\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-5\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">SQL (Structured Query Language)<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">sql<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>To apply the changes to the database, you execute the <code>migrate<\/code> command:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-6\" data-shcb-language-name=\"CSS\" data-shcb-language-slug=\"css\"><span><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">python<\/span> <span class=\"hljs-selector-tag\">manage<\/span><span class=\"hljs-selector-class\">.py<\/span> <span class=\"hljs-selector-tag\">migrate<\/span><\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-6\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">CSS<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">css<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>It&#8217;ll show the following output:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-7\" data-shcb-language-name=\"plaintext\" data-shcb-language-slug=\"plaintext\"><span><code class=\"hljs language-plaintext shcb-code-table\"><span class='shcb-loc'><span>Operations to perform:\n<\/span><\/span><span class='shcb-loc'><span>  Apply all migrations: admin, auth, blog, contenttypes, sessions\n<\/span><\/span><span class='shcb-loc'><span>Running migrations:\n<\/span><\/span><span class='shcb-loc'><span>  Applying contenttypes.0001_initial... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0001_initial... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying admin.0001_initial... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying admin.0002_logentry_remove_auto_add... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying admin.0003_logentry_add_action_flag_choices... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying contenttypes.0002_remove_content_type_name... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0002_alter_permission_name_max_length... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0003_alter_user_email_max_length... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0004_alter_user_username_opts... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0005_alter_user_last_login_null... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0006_require_contenttypes_0002... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0007_alter_validators_add_error_messages... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0008_alter_user_username_max_length... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0009_alter_user_last_name_max_length... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0010_alter_group_name_max_length... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0011_update_proxy_permissions... OK\n<\/span><\/span><span class='shcb-loc'><span>  Applying auth.0012_alter_user_first_name_max_length... OK\n<\/span><\/span><mark class='shcb-loc'><span>  Applying blog.0001_initial... OK\n<\/span><\/mark><span class='shcb-loc'><span>  Applying sessions.0001_initial... OK\n<\/span><\/span><\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-7\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">plaintext<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">plaintext<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>Note that besides applying the migration for the <code>Post<\/code> model, Django also applied the migrations for the built-in models used in authentication, authorization, sessions, etc.<\/p>\n\n\n\n<p>If you execute the <code>migrate<\/code> command again and there are no unapplied migrations, the command will output the following:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-8\" data-shcb-language-name=\"plaintext\" data-shcb-language-slug=\"plaintext\"><span><code class=\"hljs language-plaintext shcb-code-table\"><span class='shcb-loc'><span>Operations to perform:\n<\/span><\/span><span class='shcb-loc'><span>  Apply all migrations: admin, auth, blog, contenttypes, sessions, users\n<\/span><\/span><span class='shcb-loc'><span>Running migrations:\n<\/span><\/span><mark class='shcb-loc'><span>  No migrations to apply.\n<\/span><\/mark><\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-8\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">plaintext<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">plaintext<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>To list the project migrations and their status, you use the <code>showmigrations<\/code> command:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-9\" data-shcb-language-name=\"CSS\" data-shcb-language-slug=\"css\"><span><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">python<\/span> <span class=\"hljs-selector-tag\">manage<\/span><span class=\"hljs-selector-class\">.py<\/span> <span class=\"hljs-selector-tag\">showmigrations<\/span><\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-9\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">CSS<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">css<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p>Output:<\/p>\n\n\n<pre class=\"wp-block-code\" aria-describedby=\"shcb-language-10\" data-shcb-language-name=\"plaintext\" data-shcb-language-slug=\"plaintext\"><span><code class=\"hljs language-plaintext\">admin\n &#91;X] 0001_initial\n &#91;X] 0002_logentry_remove_auto_add\n &#91;X] 0003_logentry_add_action_flag_choices\nauth\n &#91;X] 0001_initial\n &#91;X] 0002_alter_permission_name_max_length\n &#91;X] 0003_alter_user_email_max_length\n &#91;X] 0004_alter_user_username_opts\n &#91;X] 0005_alter_user_last_login_null\n &#91;X] 0006_require_contenttypes_0002\n &#91;X] 0007_alter_validators_add_error_messages\n &#91;X] 0008_alter_user_username_max_length\n &#91;X] 0009_alter_user_last_name_max_length\n &#91;X] 0010_alter_group_name_max_length\n &#91;X] 0011_update_proxy_permissions\n &#91;X] 0012_alter_user_first_name_max_length\nblog\n &#91;X] 0001_initial\ncontenttypes\n &#91;X] 0001_initial\n &#91;X] 0002_remove_content_type_name\nsessions\n &#91;X] 0001_initial<\/code><\/span><small class=\"shcb-language\" id=\"shcb-language-10\"><span class=\"shcb-language__label\">Code language:<\/span> <span class=\"shcb-language__name\">plaintext<\/span> <span class=\"shcb-language__paren\">(<\/span><span class=\"shcb-language__slug\">plaintext<\/span><span class=\"shcb-language__paren\">)<\/span><\/small><\/pre>\n\n\n<p class=\"note\"><a href=\"https:\/\/www.pythontutorial.net\/wp-content\/uploads\/2023\/01\/django_project_5.zip\" target=\"_blank\" rel=\"noreferrer noopener\">Download the Django Project source code<\/a><\/p>\n\n\n\n<h2>Summary<\/h2>\n\n\n\n<ul>\n<li>Use the <code>makemigrations<\/code> command to make migrations based on the changes that you made to the models.<\/li>\n\n\n\n<li>Use the <code>migrate<\/code> command to apply changes from models to the database.<\/li>\n\n\n\n<li>Use the <code>sqlmigrate<\/code> command to view the generated SQL based on the model.<\/li>\n\n\n\n<li>Use the <code>showmigrations<\/code> command to list all migrations and their status in the project.<\/li>\n<\/ul>\n<div class=\"helpful-block-content\" data-title=\"\">\n\t<header>\n\t\t<div class=\"wth-question\">Did you find this tutorial helpful ?<\/div>\n\t\t<div class=\"wth-thumbs\">\n\t\t\t<button\n\t\t\t\tdata-post=\"5567\"\n\t\t\t\tdata-post-url=\"https:\/\/www.pythontutorial.net\/django-tutorial\/django-migrations\/\"\n\t\t\t\tdata-post-title=\"Django Migrations\"\n\t\t\t\tdata-response=\"1\"\n\t\t\t\tclass=\"wth-btn-rounded wth-yes-btn\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http:\/\/www.w3.org\/2000\/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\tclass=\"feather feather-thumbs-up block w-full h-full\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3\"\n\t\t\t\t\t><\/path>\n\t\t\t\t<\/svg>\n\t\t\t\t<span class=\"sr-only\"> Yes <\/span>\n\t\t\t<\/button>\n\n\t\t\t<button\n\t\t\t\tdata-response=\"0\"\n\t\t\t\tdata-post=\"5567\"\n\t\t\t\tdata-post-url=\"https:\/\/www.pythontutorial.net\/django-tutorial\/django-migrations\/\"\n\t\t\t\tdata-post-title=\"Django Migrations\"\n\t\t\t\tclass=\"wth-btn-rounded wth-no-btn\"\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http:\/\/www.w3.org\/2000\/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17\"\n\t\t\t\t\t><\/path>\n\t\t\t\t<\/svg>\n\t\t\t\t<span class=\"sr-only\"> No <\/span>\n\t\t\t<\/button>\n\t\t<\/div>\n\t<\/header>\n\n\t<div class=\"wth-form hidden\">\n\t\t<div class=\"wth-form-wrapper\">\n\t\t\t<div class=\"wth-title\"><\/div>\n\t\t\t<textarea class=\"wth-message\"><\/textarea>\n\t\t\t<input type=\"button\" name=\"wth-submit\" class=\"wth-btn wth-btn-submit\" id=\"wth-submit\" \/>\n\t\t\t<input type=\"button\" class=\"wth-btn wth-btn-cancel\" value=\"Cancel\" \/>\n\t\t<\/div>\n\t<\/div>\n<\/div>\n","protected":false},"excerpt":{"rendered":"<p>In this tutorial, you&#8217;ll learn how to use Django migrations to apply changes from the models to the database.<\/p>\n","protected":false},"author":1,"featured_media":0,"parent":5531,"menu_order":4,"comment_status":"closed","ping_status":"closed","template":"","meta":[],"_links":{"self":[{"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/pages\/5567"}],"collection":[{"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/comments?post=5567"}],"version-history":[{"count":5,"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/pages\/5567\/revisions"}],"predecessor-version":[{"id":6488,"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/pages\/5567\/revisions\/6488"}],"up":[{"embeddable":true,"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/pages\/5531"}],"wp:attachment":[{"href":"https:\/\/www.pythontutorial.net\/wp-json\/wp\/v2\/media?parent=5567"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}